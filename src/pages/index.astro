---
import Layout from "../layouts/Layout.astro";
---

<Layout title="DumbDecision e.V. | Bot Home">
	<main
		class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900 p-4 relative overflow-hidden"
	>
		<!-- Background Elements for depth -->
		<div
			class="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500/30 rounded-full blur-3xl -z-10 animate-pulse"
		>
		</div>
		<div
			class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500/20 rounded-full blur-3xl -z-10 animate-pulse"
			style="animation-delay: 2s;"
		>
		</div>

		<!-- Login Button in top right corner -->
		<div class="absolute top-6 right-6">
			<a
				href="/login"
				class="px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white font-semibold rounded-lg transition-colors shadow-lg hover:shadow-xl hover:scale-105 transform duration-200"
			>
				Login
			</a>
		</div>

		<h1
			class="text-5xl md:text-7xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 mb-12 drop-shadow-lg text-center"
		>
			DDT Bot
		</h1>

		<div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl">
			<!-- Status Card -->
			<a
				href="/status"
				class="group relative block p-8 rounded-2xl bg-white/10 backdrop-blur-md border border-white/20 shadow-xl hover:bg-white/20 transition-all duration-300 hover:scale-105 hover:shadow-2xl overflow-hidden"
			>
				<div
					class="absolute inset-0 bg-gradient-to-br from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"
				>
				</div>
				<div
					class="relative z-10 flex flex-col items-center text-center h-full justify-center space-y-4"
				>
					<div
						class="p-4 rounded-full bg-green-500/20 text-green-400 group-hover:bg-green-500/30 transition-colors"
					>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							class="h-12 w-12"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
							></path>
						</svg>
					</div>
					<h2 class="text-2xl font-bold text-white">System Status</h2>
					<p class="text-gray-300">
						Check the operational status of all bot services and
						shards.
					</p>
					<span
						class="inline-block px-4 py-2 rounded-full bg-white/10 text-sm font-semibold text-white group-hover:bg-white/20 transition-colors"
					>
						View Status &rarr;
					</span>
				</div>
			</a>

			<!-- Dice Roll Card -->
			<div
				class="relative p-8 rounded-2xl bg-white/10 backdrop-blur-md border border-white/20 shadow-xl overflow-hidden flex flex-col items-center"
			>
				<h2 class="text-2xl font-bold text-white mb-6">Dice Roller</h2>

				<div class="w-full space-y-6">
					<!-- Daggerheart Section -->
					<div
						class="bg-black/20 rounded-xl p-4 border border-white/5"
					>
						<h3
							class="text-lg font-semibold text-purple-300 mb-3 text-center"
						>
							Daggerheart (2d12)
						</h3>
						<div
							class="flex justify-center items-center gap-4 mb-4"
						>
							<div
								id="hope-die"
								class="w-16 h-16 flex items-center justify-center bg-gradient-to-br from-blue-400 to-blue-600 rounded-lg text-2xl font-bold text-white shadow-lg transform transition-transform duration-500"
							>
								?
							</div>
							<span class="text-gray-400 font-bold">vs</span>
							<div
								id="fear-die"
								class="w-16 h-16 flex items-center justify-center bg-gradient-to-br from-red-400 to-red-600 rounded-lg text-2xl font-bold text-white shadow-lg transform transition-transform duration-500"
							>
								?
							</div>
						</div>
						<div
							id="dh-result"
							class="text-center text-sm h-6 font-medium text-gray-300"
						>
						</div>
						<button
							id="roll-dh-btn"
							class="w-full mt-2 py-2 px-4 bg-purple-600 hover:bg-purple-500 text-white font-semibold rounded-lg transition-colors shadow-md active:scale-95"
						>
							Roll Hope & Fear
						</button>
					</div>

					<!-- DnD Section -->
					<div
						class="bg-black/20 rounded-xl p-4 border border-white/5"
					>
						<h3
							class="text-lg font-semibold text-orange-300 mb-3 text-center"
						>
							Standard (d20)
						</h3>
						<div class="flex justify-center mb-4">
							<div
								id="d20-die"
								class="w-20 h-20 flex items-center justify-center bg-gradient-to-br from-orange-500 to-yellow-600 clip-hexagon text-3xl font-bold text-white shadow-lg transform transition-transform duration-500"
							>
								20
							</div>
						</div>
						<button
							id="roll-d20-btn"
							class="w-full mt-2 py-2 px-4 bg-orange-600 hover:bg-orange-500 text-white font-semibold rounded-lg transition-colors shadow-md active:scale-95"
						>
							Roll d20
						</button>
					</div>
				</div>
			</div>
		</div>
	</main>
</Layout>

<style>
	.clip-hexagon {
		clip-path: polygon(
			50% 0%,
			100% 25%,
			100% 75%,
			50% 100%,
			0% 75%,
			0% 25%
		);
	}
	.rolling {
		animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
	}

	@keyframes shake {
		10%,
		90% {
			transform: translate3d(-1px, 0, 0) rotate(-5deg);
		}
		20%,
		80% {
			transform: translate3d(2px, 0, 0) rotate(5deg);
		}
		30%,
		50%,
		70% {
			transform: translate3d(-4px, 0, 0) rotate(-5deg);
		}
		40%,
		60% {
			transform: translate3d(4px, 0, 0) rotate(5deg);
		}
	}
</style>

<script>
	// Daggerheart Logic
	const hopeDie = document.getElementById("hope-die");
	const fearDie = document.getElementById("fear-die");
	const dhResult = document.getElementById("dh-result");
	const rollDhBtn = document.getElementById("roll-dh-btn");

	function rollDie(sides) {
		return Math.floor(Math.random() * sides) + 1;
	}

	function animateRoll(element, finalValue, duration = 500) {
		element.classList.add("rolling");
		let startTime = null;

		function step(timestamp) {
			if (!startTime) startTime = timestamp;
			const progress = timestamp - startTime;

			// Show random numbers during animation
			element.textContent =
				Math.floor(
					Math.random() * (element.id === "d20-die" ? 20 : 12),
				) + 1;

			if (progress < duration) {
				window.requestAnimationFrame(step);
			} else {
				element.textContent = finalValue;
				element.classList.remove("rolling");
			}
		}
		window.requestAnimationFrame(step);
	}

	rollDhBtn?.addEventListener("click", () => {
		if (rollDhBtn.hasAttribute("disabled")) return;

		// Disable button during roll
		rollDhBtn.setAttribute("disabled", "true");
		rollDhBtn.classList.add("opacity-50", "cursor-not-allowed");
		dhResult.textContent = "Rolling...";

		const hope = rollDie(12);
		const fear = rollDie(12);

		animateRoll(hopeDie, hope);
		animateRoll(fearDie, fear);

		setTimeout(() => {
			const total = hope + fear;
			let resultText = `Total: ${total}`;

			if (hope > fear) {
				resultText += " (Hope)";
				dhResult.className =
					"text-center text-sm h-6 font-bold text-blue-400";
			} else if (fear > hope) {
				resultText += " (Fear)";
				dhResult.className =
					"text-center text-sm h-6 font-bold text-red-400";
			} else {
				resultText += " (Critical!)";
				dhResult.className =
					"text-center text-sm h-6 font-bold text-purple-400";
			}

			dhResult.textContent = resultText;
			rollDhBtn.removeAttribute("disabled");
			rollDhBtn.classList.remove("opacity-50", "cursor-not-allowed");
		}, 500);
	});

	// DnD Logic
	const d20Die = document.getElementById("d20-die");
	const rollD20Btn = document.getElementById("roll-d20-btn");

	rollD20Btn?.addEventListener("click", () => {
		if (rollD20Btn.hasAttribute("disabled")) return;

		rollD20Btn.setAttribute("disabled", "true");
		rollD20Btn.classList.add("opacity-50", "cursor-not-allowed");

		const result = rollDie(20);
		animateRoll(d20Die, result);

		setTimeout(() => {
			if (result === 20) {
				d20Die.classList.add("text-yellow-300");
			} else if (result === 1) {
				d20Die.classList.add("text-red-500");
			} else {
				d20Die.classList.remove("text-yellow-300", "text-red-500");
			}
			rollD20Btn.removeAttribute("disabled");
			rollD20Btn.classList.remove("opacity-50", "cursor-not-allowed");
		}, 500);
	});
</script>
